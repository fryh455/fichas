<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GM • Fichas</title>
  <link rel="stylesheet" href="./app.css" />
</head>
<body data-page="gm">
  <main class="container">
    <header class="topbar">
      <div>
        <h1>GM</h1>
        <div class="muted">roomId: <code id="roomIdOut"></code> • code: <strong id="roomCodeOut">?</strong></div>
      </div>
      <button id="btnSignOut" class="btn danger">Sair</button>
    </header>

    <div id="status" class="status"></div>

    <section class="card" id="gmKeyCard">
      <h2>Chave do GM</h2>
      <div class="row wrap">
        <input id="gmKeyOut" readonly placeholder="(sem chave salva neste navegador)" />
        <button id="btnCopyGmKey" class="btn">Copiar</button>
      </div>
      <div class="muted">Guarde esta chave. Ela permite recuperar o GM em outro navegador/dispositivo.</div>
    </section>

    <section class="grid2">
      <div class="card">
        <h2>Membros</h2>
        <div id="membersList" class="list"></div>
      </div>

      <div class="card">
        <h2>Fichas</h2>
        <div class="row">
          <button id="btnNewSheet" class="btn primary">Nova ficha</button>
        </div>
        <div id="sheetsList" class="list"></div>
      </div>
    </section>

    <section class="grid2">
      <div class="card">
        <h2>Atribuir ficha</h2>
        <label>Player
          <select id="assignPlayer"></select>
        </label>
        <label>Ficha
          <select id="assignSheet"></select>
        </label>
        <button id="btnAssign" class="btn primary">Salvar atribuição</button>
        <button id="btnUnassign" class="btn danger">Remover ficha do player</button>
      </div>

      <div class="card">
        <h2>Import massivo</h2>
        <label>Modo
          <select id="importMode">
            <option value="MERGE">MERGE</option>
            <option value="CREATE_ONLY">CREATE-ONLY</option>
          </select>
        </label>
        <label>Upload .json
          <input id="importFile" type="file" accept=".json,application/json" />
        </label>
        <label>JSON
          <textarea id="importText" rows="8" spellcheck="false"></textarea>
        </label>
        <div class="row">
          <button id="btnValidateImport" class="btn">Validar</button>
          <button id="btnDoImport" class="btn primary">Importar</button>
        </div>
        <pre id="importReport" class="pre"></pre>
      </div>
    </section>

    <section class="card">
      <h2>Logs de rolagem</h2>
      <div class="muted">Mostra automaticamente as rolagens dos players (total). Clique em “Revelar” para ver os modificadores.</div>
      <div id="rollLogsList" class="list" style="margin-top:10px"></div>
    </section>

    <section class="card" id="sheetEditorEmpty">
      <div class="muted">Selecione uma ficha para editar ou clique “Nova ficha”.</div>
    </section>

    <section class="card hidden" id="sheetEditorPane">
      <h2 id="sheetFormTitle">Criar</h2>

      <form id="sheetForm" class="form">
        <input id="sheetId" type="hidden" />
        <label>Nome (ID = slug do nome)
          <input id="sheetName" />
        </label>

        <div class="grid4">
          <label>QI <input id="attrQI" type="number" step="1" /></label>
          <label>FOR <input id="attrFOR" type="number" step="1" /></label>
          <label>DEX <input id="attrDEX" type="number" step="1" /></label>
          <label>VIG <input id="attrVIG" type="number" step="1" /></label>
        </div>

        <label>Mental (int)
          <input id="mental" type="number" step="1" />
        </label>

        <label>Anotações compartilhadas (GM + Player)
          <textarea id="sharedNotes" rows="6" spellcheck="false" placeholder="Anotações da ficha..."></textarea>
        </label>

        <div class="row">
          <button id="btnSaveSheet" class="btn primary" type="submit">Salvar ficha</button>
          <button id="btnCancelSheet" class="btn" type="button">Cancelar</button>
          <button id="btnDeleteSheet" class="btn danger" type="button">Deletar ficha</button>
        </div>
      </form>

      <hr />

      <section class="grid2">
        <div>
          <h3>Itens</h3>
          <div class="row"><button id="btnAddItem" class="btn small">Adicionar</button></div>
          <div id="itemsCrudList" class="list"></div>
        </div>
        <div>
          <h3>Vantagens</h3>
          <div class="row"><button id="btnAddAdv" class="btn small">Adicionar</button></div>
          <div id="advantagesCrudList" class="list"></div>
        </div>
      </section>

      <section class="grid2" style="margin-top:16px">
        <div>
          <h3>Desvantagens</h3>
          <div class="row"><button id="btnAddDis" class="btn small">Adicionar</button></div>
          <div id="disadvantagesCrudList" class="list"></div>
        </div>

        <div>
          <h3>Editor</h3>
          <div class="form">
            <label>Categoria
              <select id="entryCategory">
                <option value="items">items</option>
                <option value="advantages">advantages</option>
                <option value="disadvantages">disadvantages</option>
              </select>
            </label>
            <input id="entryId" type="hidden" />
            <label>Nome <input id="entryName" /></label>
            <label>Tipo
              <select id="entryType">
                <option value="PASSIVA">PASSIVA</option>
                <option value="ATIVA">ATIVA</option>
              </select>
            </label>
            <label>Atributo base
              <select id="entryAttrBase">
                <option value="">(nenhum)</option>
                <option value="QI">QI</option>
                <option value="FOR">FOR</option>
                <option value="DEX">DEX</option>
                <option value="VIG">VIG</option>
                <option value="INTENCOES">INTENCOES</option>
                <option value="DEF">DEF</option>
                <option value="MOV">MOV</option>
                <option value="INV">INV</option>
              </select>
            </label>
            <label>modMode
              <select id="entryModMode">
                <option value="NONE">NONE</option>
                <option value="SOMA">SOMA</option>
                <option value="MULT">MULT</option>
              </select>
            </label>
            <label>modValue <input id="entryModValue" type="number" step="0.1" /></label>
            <label>usesCurrent <input id="entryUsesCurrent" type="number" step="1" /></label>
            <label>usesMax <input id="entryUsesMax" type="number" step="1" /></label>
            <label>Notes <textarea id="entryNotes" rows="3"></textarea></label>
            <div class="row">
              <button id="btnSaveEntry" class="btn primary small" type="button">Salvar registro</button>
              <button id="btnDeleteEntry" class="btn danger small" type="button">Deletar</button>
              <button id="btnClearEntry" class="btn small" type="button">Limpar</button>
            </div>
          </div>
        </div>
      </section>
    </section>
  </main>

  <script type="module" src="./app.js"></script>
</body>
</html>
