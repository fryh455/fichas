<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GM • Fichas</title>
  <link rel="stylesheet" href="./app.css" />
</head>
<body data-page="gm">
  
<main class="container">
  <header class="topbar">
    <div>
      <h1>GM</h1>
      <div class="muted">code: <span id="roomCodeOut">?</span> • roomId: <span id="roomIdOut">...</span></div>
    </div>
    <div class="row" style="margin:0">
      <button id="btnSignOut" class="btn danger small">Sair</button>
    </div>
  </header>

  <div id="status" class="status"></div>

  <div class="tabsBar" id="gmMainTabs">
    <button class="tabBtn active" data-tab="gm_sheets">Fichas</button>
    <button class="tabBtn" data-tab="gm_players">Players</button>
    <button class="tabBtn" data-tab="gm_editor">Criar/Editar ficha</button>
    <button class="tabBtn" data-tab="gm_import">Import massivo</button>
    <button class="tabBtn" data-tab="gm_assign">Atribuir ficha</button>
    <div class="spacer"></div>
    <button class="tabBtn" data-tab="gm_rolls">Rolagens</button>
  </div>

  <div class="tabPanel active" data-panel="gm_sheets">
    <section class="grid2">
      <section class="card">
        <h2>Membros</h2>
        <div id="membersList" class="list"></div>
      </section>

      <section class="card">
        <div class="row" style="justify-content:space-between; align-items:center">
          <h2 style="margin:0">Fichas</h2>
          <button id="btnNewSheet" class="btn small primary" type="button">Nova ficha</button>
        </div>
        <div id="sheetsList" class="list mt12"></div>
      </section>
    </section>
  </div>

  <div class="tabPanel" data-panel="gm_players">
    <section class="card">
      <h2>Players</h2>
      <div id="gmPlayersList" class="list"></div>
    </section>
  </div>

  <div class="tabPanel" data-panel="gm_editor">
    <section class="card">
      <h2 id="sheetFormTitle">Criar</h2>

      <div id="sheetEditorEmpty" class="muted">Selecione uma ficha na aba “Fichas” ou clique “Nova ficha”.</div>

      <div id="sheetEditorPane" class="hidden">
        <div class="miniTabs" id="gmEditorTabs">
          <button type="button" class="miniBtn active" data-mini="attrs">Atributos</button>
          <button type="button" class="miniBtn" data-mini="items">Itens</button>
          <button type="button" class="miniBtn" data-mini="advantages">Vantagens</button>
          <button type="button" class="miniBtn" data-mini="disadvantages">Desvantagens</button>
        </div>

        <div class="miniPanel active" data-mini-panel="attrs">
          <form id="sheetForm" class="form">
            <input id="sheetId" type="hidden" />

            <label>Nome da ficha
              <input id="sheetName" type="text" placeholder="Nome do personagem" />
            </label>

            <div class="grid4">
              <label>QI <input id="attrQI" type="number" step="1" /></label>
              <label>FOR <input id="attrFOR" type="number" step="1" /></label>
              <label>DEX <input id="attrDEX" type="number" step="1" /></label>
              <label>VIG <input id="attrVIG" type="number" step="1" /></label>
            </div>

            <label>Mental
              <input id="mental" type="number" step="1" />
            </label>

            <label>Imagem (perfil)
              <input id="sheetAvatarFile" type="file" accept="image/*" />
              <div class="row" style="gap:10px; align-items:center">
                <img id="sheetAvatarPreview" class="avatarPreview" alt="preview" />
                <button id="btnClearAvatar" class="btn small" type="button">Remover imagem</button>
              </div>
            </label>

            <label>Anotações (compartilhadas)
              <textarea id="sharedNotes" class="textarea" rows="6"></textarea>
            </label>

            <div class="row">
              <button class="btn primary" type="submit">Salvar ficha</button>
              <button id="btnCancelSheet" class="btn ghost" type="button">Cancelar</button>
              <button id="btnDeleteSheet" class="btn danger" type="button">Deletar ficha</button>
            </div>
          </form>
        </div>

        <div class="miniPanel" data-mini-panel="items">
          <div class="row" style="justify-content:space-between; align-items:center">
            <h3 style="margin:0">Itens</h3>
            <button id="btnAddItem" class="btn small" type="button">Adicionar</button>
          </div>
          <div id="itemsCrudList" class="list mt12"></div>
        </div>

        <div class="miniPanel" data-mini-panel="advantages">
          <div class="row" style="justify-content:space-between; align-items:center">
            <h3 style="margin:0">Vantagens</h3>
            <button id="btnAddAdv" class="btn small" type="button">Adicionar</button>
          </div>
          <div id="advantagesCrudList" class="list mt12"></div>
        </div>

        <div class="miniPanel" data-mini-panel="disadvantages">
          <div class="row" style="justify-content:space-between; align-items:center">
            <h3 style="margin:0">Desvantagens</h3>
            <button id="btnAddDis" class="btn small" type="button">Adicionar</button>
          </div>
          <div id="disadvantagesCrudList" class="list mt12"></div>
        </div>

        <hr/>

        <h3>Editor de registro</h3>
        <div class="grid2">
          <label>Categoria
            <select id="entryCategory">
              <option value="items">Itens</option>
              <option value="advantages">Vantagens</option>
              <option value="disadvantages">Desvantagens</option>
            </select>
          </label>
          <label>ID
            <input id="entryId" type="text" readonly />
          </label>
        </div>

        <label>Nome
          <input id="entryName" type="text" />
        </label>

        <div class="grid4">
          <label>Tipo
            <select id="entryType">
              <option value="PASSIVA">PASSIVA</option>
              <option value="ATIVA">ATIVA</option>
            </select>
          </label>
          <label>Atributo base
            <select id="entryAttrBase">
              <option value="">(nenhum)</option>
              <option value="QI">QI</option>
              <option value="FOR">FOR</option>
              <option value="DEX">DEX</option>
              <option value="VIG">VIG</option>
            </select>
          </label>
          <label>Mod mode
            <select id="entryModMode">
              <option value="NONE">NONE</option>
              <option value="SOMA">SOMA</option>
              <option value="MULT">MULT</option>
            </select>
          </label>
          <label>Mod value
            <input id="entryModValue" type="number" step="0.1" />
          </label>
        </div>

        <div class="grid2">
          <label>Uses current
            <input id="entryUsesCurrent" type="number" step="1" />
          </label>
          <label>Uses max
            <input id="entryUsesMax" type="number" step="1" />
          </label>
        </div>

        <label>Notes
          <textarea id="entryNotes" class="textarea" rows="3"></textarea>
        </label>

        <div class="row">
          <button id="btnSaveEntry" class="btn primary" type="button">Salvar registro</button>
          <button id="btnDeleteEntry" class="btn danger" type="button">Deletar registro</button>
          <button id="btnClearEntry" class="btn" type="button">Limpar seleção</button>
        </div>
      </div>
    </section>
  </div>

  <div class="tabPanel" data-panel="gm_import">
    <section class="card">
      <h2>Import massivo</h2>
      <label>JSON
        <textarea id="importText" class="textarea" rows="10" placeholder='{"sheets":[...]}'></textarea>
      </label>
      <div class="row">
        <input id="importFile" type="file" accept=".json,application/json" />
        <select id="importMode">
          <option value="MERGE">MERGE</option>
          <option value="CREATE_ONLY">CREATE-ONLY</option>
        </select>
        <button id="btnValidateImport" class="btn">Validar</button>
        <button id="btnDoImport" class="btn primary">Importar</button>
      </div>
      <pre id="importReport" class="code mt12"></pre>
    </section>
  </div>

  <div class="tabPanel" data-panel="gm_assign">
    <section class="card">
      <h2>Atribuir ficha</h2>
      <div class="grid2">
        <label>Player
          <select id="assignPlayer"></select>
        </label>
        <label>Ficha
          <select id="assignSheet"></select>
        </label>
      </div>
      <div class="row">
        <button id="btnAssign" class="btn primary" type="button">Vincular</button>
      </div>
      <div class="mt12">
        <h3>Fichas vinculadas ao player</h3>
        <div id="playerAssignmentsList" class="list mt12"></div>
      </div>
    </section>
  </div>

  <div class="tabPanel" data-panel="gm_rolls">
    <section class="card">
      <h2>Rolagens (todos)</h2>
      <div class="muted">Mostra apenas total e player.</div>
      <div id="gmRollsList" class="list mt12"></div>
    </section>
  </div>
</main>


  <script type="module" src="./app.js"></script>
</body>
</html>
