{
  "rules": {
    ".read": false,
    ".write": false,

    "rooms": {
      "$roomId": {
        ".read": "auth != null && root.child('rooms/' + $roomId + '/members/' + auth.uid).exists()",
        ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)",

        "meta": {
          ".read": "auth != null && root.child('rooms/' + $roomId + '/members/' + auth.uid).exists()",
          ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)"
        },

        "members": {
          "$uid": {
            ".read": "auth != null && (auth.uid === $uid || root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)",
            ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid || (auth.uid === $uid && !data.exists()))"
          }
        },

        "characters": {
          "$uid": {
            ".read": "auth != null && (auth.uid === $uid || root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)",
            "$charId": {
              ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid || auth.uid === $uid)",

              "image": {
                "dataBase64": {
                  ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid || auth.uid === $uid)"
                },
                "width": {
                  ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)"
                },
                "height": {
                  ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)"
                },
                "fit": {
                  ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)"
                }
              }
            }
          }
        },

        "mental": {
          "$uid": {
            ".read": "auth != null && (auth.uid === $uid || root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)",
            ".write": "auth != null && (auth.uid === $uid || root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)"
          }
        },

        "rolls": {
          ".read": "auth != null && root.child('rooms/' + $roomId + '/members/' + auth.uid).exists()",
          "$pushId": {
            ".write": "auth != null && root.child('rooms/' + $roomId + '/members/' + auth.uid).exists() && !data.exists()",
            ".validate": "newData.hasChildren(['uid','displayName','role','charId','sourceType','sourceId','sourceName','diceRolled','components','autoSum','totalFinal','timestamp'])"
          }
        },

        "gm": {
          ".read": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)",
          ".write": "auth != null && (root.child('rooms/' + $roomId + '/meta/gmUid').val() === auth.uid)"
        }
      }
    }
  }
}
